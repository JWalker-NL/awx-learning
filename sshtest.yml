-  name: Test SSH
   hosts: all
   gather_facts: false
   vars:
      ansible_connection: ssh
      ansible_shell_type: powershell


   tasks:
     - name: Test SSH
       ansible.windows.win_file:
        path: C:\Temp\foo.conf
        state: touch
     - name: Disable WinRM
       ansible.windows.win_powershell:
        script: |
          disable-psremoting -force
          Remove-WSManInstance -ResourceUri winrm/config/Listener -force
          Stop-Service WinRM -PassThru
          Set-Service WinRM -StartupType Disabled -PassThru

     - name: Install all security, critical, and rollup updates without a scheduled task
       ansible.windows.win_updates:
         category_names:
           - SecurityUpdates
           - CriticalUpdates
           - UpdateRollups
         reboot: true
       become: true
       become_method: runas
       become_user: SYSTEM
