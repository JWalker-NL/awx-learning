---
-  name: DC Promot
   hosts: all
   gather_facts: true
   vars:
      ansible_connection: winrm 
      ansible_winrm_transport: ntlm
      ansible_winrm_port: 5985
      ansible_winrm_server_cert_validation: ignore

   tasks: 
    - name: Create new Windows domain in a new forest with specific parameters and reboot in post task
      microsoft.ad.domain:
        create_dns_delegation: false
        dns_domain_name: ad-test.local
        domain_netbios_name: AD-TEST
        domain_mode: Win2025
        forest_mode: Win2025
        safe_mode_password: password123!
      register: domain_install
      when: "DC01" in ansible_facts["ansible_hostname"]

    - name: Reboot if needed
      ansible.windows.win_reboot:
      when: domain_install.reboot_required
         
    - name: Join existing Windows Domain if DC02
      microsoft.ad.domain_controller:
        dns_domain_name: ad-test.local
        domain_admin_user: silver@ad-test.local
        domain_admin_password: password123!
        safe_mode_password: password123!
        state: domain_controller
        reboot: true
      when: "DC02" in ansible_facts["ansible_hostname"]


