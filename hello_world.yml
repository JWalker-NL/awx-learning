---
-  name: DC Promot
   hosts: all
   gather_facts: false
   set_fact:
      ansible_connection=winrm 
      ansible_winrm_transport=basic
      ansible_winrm_port=5985
      ansible_winrm_server_cert_validation=ignore

   tasks: 
    - name: Create new Windows domain in a new forest with specific parameters and reboot in post task
      microsoft.ad.domain:
        create_dns_delegation: false
        dns_domain_name: ad-test.local
        domain_netbios_name: AD-TEST
        domain_mode: Win2025
        forest_mode: Win2025
        safe_mode_password: "{{ ansible_ssh_pass }}"
      register: domain_install

    - name: Reboot if needed
      ansible.windows.win_reboot:
      when: domain_install.reboot_required
